<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karmaşıklık Matrisi</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function addTaskInput(taskLabel = '', complexity = '', impact = '') {
            var taskInputs = document.getElementById('taskInputs');
            var index = taskInputs.children.length / 3; // Each task has three inputs
            var taskDiv = document.createElement('div');
            taskDiv.className = 'task-group';
            taskDiv.innerHTML = `
                <div class="form-group">
                    <label for="taskLabel${index}">Değer Adı:</label>
                    <input type="text" class="form-control" id="taskLabel${index}" name="taskLabel${index}" value="${taskLabel}" required>
                </div>
                <div class="form-group">
                    <label for="complexity${index}">Karmaşıklık (1-5):</label>
                    <input type="number" class="form-control" id="complexity${index}" name="complexity${index}" min="1" max="5" value="${complexity}" required>
                </div>
                <div class="form-group">
                    <label for="impact${index}">Etki (1-5):</label>
                    <input type="number" class="form-control" id="impact${index}" name="impact${index}" min="1" max="5" value="${impact}" required>
                </div>
            `;
            taskInputs.appendChild(taskDiv);
        }

        function validateInputs() {
            var taskInputs = document.getElementById('taskInputs');
            var taskCount = taskInputs.children.length / 3; // Each task has three inputs
            for (var i = 0; i < taskCount; i++) {
                var complexity = parseInt(document.getElementById(`complexity${i}`).value);
                var impact = parseInt(document.getElementById(`impact${i}`).value);
                if (complexity < 1 || complexity > 5 || impact < 1 || impact > 5) {
                    alert(`Hata: Görev ${i+1} için karmaşıklık ve etki değerleri 1-5 aralığında olmalıdır`);
                    return false;
                }
            }
            return true;
        }
    </script>
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Karmaşıklık Matrisi</h1>
        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#faqModal">SSS</button>
        
        <!-- FAQ Modal -->
        <div class="modal fade" id="faqModal" tabindex="-1" aria-labelledby="faqModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="faqModalLabel">Sıkça Sorulan Sorular</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="accordion" id="faqAccordion">
                            <div class="card">
                                <div class="card-header" id="headingOne">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                            Karmaşıklık matrisi nedir?
                                        </button>
                                    </h2>
                                </div>
                                <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#faqAccordion">
                                    <div class="card-body">
                                        Karmaşıklık matrisi, bir sistemin veya projenin karmaşıklığını değerlendirmek için kullanılan bir araçtır.
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="headingTwo">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                            Karmaşıklık matrisi neyi çözer?
                                        </button>
                                    </h2>
                                </div>
                                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#faqAccordion">
                                    <div class="card-body">
                                        Karmaşıklık matrisi, bir sistemin veya projenin karmaşıklığını analiz ederek, potansiyel sorunları ve iyileştirme alanlarını belirlemeye yardımcı olur.
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="headingThree">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                            Karmaşıklık matrisi nasıl kullanılır?
                                        </button>
                                    </h2>
                                </div>
                                <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#faqAccordion">
                                    <div class="card-body">
                                        Karmaşıklık matrisi, sistemin veya projenin farklı bileşenlerinin karmaşıklığını değerlendirmek için kullanılır. Her bileşen için karmaşıklık puanları belirlenir ve bu puanlar matriste gösterilir.
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="headingFour">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                            Nasıl Çalışır?
                                        </button>
                                    </h2>
                                </div>
                                <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#faqAccordion">
                                    <div class="card-body">
                                        <p>1. Kullanıcıdan iş durumları için karmaşıklık ve etki değerlerini alır.</p>
                                        <p>2. Bu değerleri kullanarak karmaşıklık matrisini oluşturur.</p>
                                        <p>3. Matrisin grafiğini oluşturur ve ekranda gösterir.</p>
                                        <p>4. Ölçümler ve türevler hesaplanarak ekranda gösterilir.</p>
                                        <p>Örnek Matris:</p>
                                        <pre>
API Entegrasyonu: Karmaşıklık 3, Etki 4
Bildirim Sistemi: Karmaşıklık 2, Etki 3
Raporlama: Karmaşıklık 4, Etki 5
Kullanıcı Girişi: Karmaşıklık 1, Etki 2
                                        </pre>
                                        <p>Bu matrisin grafiği ve sonuçları aşağıdaki gibidir:</p>
                                        <p>Hassasiyet: 0,2500 (TPR = TP / (TP + FN))</p>
                                        <p>Özgüllük: 0,6552 (SPC = TN / (FP + TN))</p>
                                        <p>Kesinlik: 0,3333 (PPV = TP / (TP + FP))</p>
                                        <p>Negatif Tahmini Değer: 0,5588 (NBD = TN / (TN + FN))</p>
                                        <p>Yanlış Pozitif Oranı: 0,3448 (FPR = FP / (FP + TN))</p>
                                        <p>Yanlış Keşif Oranı: 0,6667 (FDR = FP / (FP + TP))</p>
                                        <p>Yanlış Negatif Oranı: 0,7500 (FNR = FN / (FN + TP))</p>
                                        <p>Kesinlik: 0,4898 (ACC = (TP + TN) / (P + N))</p>
                                        <p>F1 Puanı: 0,2857 (F1 = 2TP / (2TP + FP + FN))</p>
                                        <p>Matthews Korelasyon Katsayısı: -0,1011 (TP*TN - FP*FN / sqrt((TP+FP)*(TP+FN)*(TN+FP)*(TN+FN)))</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Add more questions and answers as needed -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <form method="POST" action="/calculate" class="mt-4" onsubmit="return validateInputs()">
            <div id="taskInputs">
                <!-- Dynamic task inputs will be added here -->
                {% for i in range(task_count) %}
                <script>
                    addTaskInput("{{ task_labels[i] }}", "{{ complexities[i] }}", "{{ impacts[i] }}");
                </script>
                {% endfor %}
            </div>
            <button type="button" class="btn btn-secondary" onclick="addTaskInput()">Değer Ekle</button>
            <button type="submit" class="btn btn-primary">Sonuç Getir</button>
        </form>

        <h2 class="mt-5">Grafik</h2>
        <div class="row">
            <div class="col-md-6">
                <h3>Bar Chart</h3>
                <div id="barChart">
                    {% if graph_url %}
                    <img src="data:image/png;base64,{{ graph_url }}" alt="Karmaşıklık Matrisi Bar Chart">
                    {% endif %}
                </div>
            </div>
            <div class="col-md-6">
                <h3>Heatmap</h3>
                <div id="heatmap">
                    {% if heatmap_url %}
                    <img src="data:image/png;base64,{{ heatmap_url }}" alt="Karmaşıklık Matrisi Heatmap">
                    {% endif %}
                </div>
            </div>
        </div>

        <h2 class="mt-5">Ölçümler ve Türevler</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Ölçüm</th>
                    <th>Değer</th>
                    <th>Türevler</th>
                </tr>
            </thead>
            <tbody>
                {% for measure in measures %}
                <tr>
                    <td>{{ measure.name }}</td>
                    <td>{{ measure.value }}</td>
                    <td>{{ measure.formula }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
